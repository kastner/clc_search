<!doctype html>
<!-- paulirish.com/2008/conditional-stylesheets-vs-css-hacks-answer-neither/ -->
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!-- Consider adding a manifest.appcache: h5bp.com/d/Offline -->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Colour Lovers NEAR search</title>
  <base href="/clc">
  <meta name="description" content="">
  <meta name="author" content="">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="stylesheet/less" href="/clc/bootstrap/lib/estrap.less">
  <script src="/clc/less.js"></script>
  
  <script src="/clc/js/modernizr-2.0.6.min.js"></script>
  <style type="text/css" media="screen">
    body {
      background: #eee;
    }
    #boxes {
      list-style: none;
      margin-left: 0;
      padding-left: 0;
    }
    #boxes li {
      padding: 10px;
      font-weight: 300;
      margin-bottom: 3px;
      text-shadow: rgba(255,255,255,0.5) 0px 1px 0px;
    }
    #swatch {
      width: 50px;
      height: 20px;
      border: 1px solid black;
      float: left;
      margin-right: 5px;
    }
  </style>
</head>

<body>
   <!-- <textarea id="thing" rows="20" cols="200" style="width:500px">asdf</textarea> -->

  <div class="container">

  <article>
    <h1>Colour Lovers color &ldquo;nearness&rdquo; search</h1>

    <p class="well">
      This is a search for colors on <a href="http://www.colourlovers.com/" title="Color Trends + Palettes :: COLOURlovers">Colourlovers</a>. It searches for colors NEAR the one you input in to the boxes.
      It uses <a href="http://lucene.apache.org/solr/" title="Welcome to Solr">solr</a> and computes the elucidian distance between colors in the RGB space.<br>
      <br>
      Click on the color box for a colorpicker.
    </p>
    <form id="colorValues" class="form-vertical">
      <div class="clearfix">
        <label>RGB (0-255)</label>
        <div class="input">
          <div class="inline-inputs">
            <input class="mini" id="red" type="text" value="200">
            <input class="mini" id="green" type="text" value="120">
            <input class="mini" id="blue" type="text" value="17">
            <div id="swatch"></div>
            <div id="colorpicker"></div>
          </div>
        </div>
      </div>
      <div class="clearfix">
        <h3></h3>
      </div>
      <div class="clearfix">
        <label>HEX</label>
        <div class="input">
          <input class="small" size="8" id="hex" type="text" value="">
          <input type="submit" class="btn" value="Go">
        </div>
      </div>
    </form>

    <ul id="boxes"></ul>
    
  </article>

  <footer>
    <p>&copy; Erik Kastner</p>
  </footer>

  </div>
  <!-- Grab Google CDN's jQuery, with a protocol relative URL; fall back to local if offline -->
  <!--<script src="//ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js"></script>-->
  <script src="/clc/js/jquery-1.4.2.min.js" type="text/javascript" charset="utf-8"></script>
  <script type="text/javascript" src="/clc/farbtastic/farbtastic.js"></script>
  <link rel="stylesheet" href="/clc/farbtastic/farbtastic.css" type="text/css" />  
  <!--[if lt IE 7 ]>
    <script defer src="//ajax.googleapis.com/ajax/libs/chrome-frame/1.0.3/CFInstall.min.js"></script>
    <script defer>window.attachEvent('onload',function(){CFInstall.check({mode:'overlay'})})</script>
  <![endif]-->
  
  <script type="text/javascript" charset="utf-8">
    var r = 200;
    var g = 70;
    var b = 20;
    
    var h = 153;
    var s = 50;
    var l = 50;
    
    $("#colorValues").live("submit", function(evt) {
      evt.preventDefault();

      $("#colorpicker").hide();

      var r = $("#red").val();
      var g = $("#green").val();
      var b = $("#blue").val();

      $("#boxes li").remove();
      $("<li>")
        .appendTo("#boxes")
        .html("<b>Your picked color</b> ("+r+", "+g+", "+b+")")
        .css("backgroundColor", "rgb("+r+","+g+","+b+")");
      // $.get("http://solr.metaatem.net/solr/" + "select?version=2.2&q=*%3A*&start=0" + "&rows=50&fl=*%2Cscore&qt=" + "&wt=json&sort=dist(2,red,green,blue," + r + "," + g + "," + b + ")%20asc&json.wrf=?", function(m) {
      // $.get("http://solr.metaatem.net/solr/" + "select?version=2.2&q={!func}div(1,dist(2,red,green,blue," + r + "," + g + "," + b + "))&start=0" + "&rows=50&fl=*%2Cscore&qt=" + "&wt=json&sort=score%20desc,rank%20asc,numScores%20desc" + "&json.wrf=?", function(m) {
      $.get("/solr/" + "select?version=2.2&q={!func}product(div(1,sqedist(red,green,blue," + r + "," + g + "," + b + ")),recip(rank,1,1000,1000))&start=0" + "&rows=50&fl=*%2Cscore&qt=" + "&wt=json&sort=score%20desc,rank%20asc,numScores%20desc" + "&json.wrf=?", function(m) {
        // console.log(m);
        m.response.docs.forEach(function (o, i) {
          var link = "<a href='" + o.url + "' target='_blank'>" + o.title + "</a>";
          link += " " + o.rank + " / " + o.numScores;
          $("<li>")
            .appendTo("#boxes")
            .html(link + " ("+o.red+", "+o.green+", "+o.blue+")")
            .css("backgroundColor", "#"+o.hex);
        });
      }, "jsonp");
    })

    function updateRGB() {
      var r = $("#red").val();
      var g = $("#green").val();
      var b = $("#blue").val();

      $("#swatch").css("backgroundColor", "rgb(" + r +", " + g + ", " + b + ")");
    }
var fa;

    function updateFromHex(hex) {
      $("#swatch").css("backgroundColor", "#" + hex);
      rgb = $("#swatch").css("backgroundColor").match(/\d+/g);
      $("#red").val(rgb[0]);
      $("#green").val(rgb[1]);
      $("#blue").val(rgb[2]);
    }

    $(function() {
      setTimeout(function () {
         $("#thing").html(($("style")[0].innerHTML));
        var rR = Math.floor(Math.random() * 255);
        var rG = Math.floor(Math.random() * 255);
        var rB = Math.floor(Math.random() * 255);
        $("#red").val(rR);
        $("#green").val(rG);
        $("#blue").val(rB);
        $("#hex").val(rR.toString(16) + rG.toString(16) + rB.toString(16));
        updateRGB();
        $("#swatch").live("click", function() {
          $.farbtastic("#colorpicker", function(farb) {
            $("#hex").val(farb);
            updateFromHex(farb.replace(/^#/,''));
          }).setColor('#' + $("#hex").val().replace(/^#/,''));
          $("#colorpicker").show();
        })
      }, 100);

      $("#red, #green, #blue, #hex").live("keyup", function() {
        var id = $(this).attr("id");
        if (id == "hex") {
          var hex = $("#hex").val();
          hex = hex.replace(/^#/, '');
          if (hex.match(/^[\da-f]{3}$/i) || hex.match(/^[\da-f]{6}$/i)) {
            updateFromHex(hex);
          } else {
            return false;
          }
        }
        updateRGB();
      });
    });
  </script>
</body>
</html>
